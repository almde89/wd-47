function salvaCartaoJquery(o){o.preventDefault();var a=$(".novoCartao-conteudo",this);console.log(a);var e=a.val().trim().replace(/\n/g,"<br>").replace(/(\*\*)(\w+)(\*\*)/g,function(o,a,e,r,t,n){return"<b>"+e+"</b>"}).replace(/(\*)(\w+)(\*)/g,function(o,a,e,r,t,n){return"<em>"+e+"</em>"});console.log("tam ("+e.length+")"),console.log(e),e&&(controladorCartoes.cria(e),broadcast.emitirEvento(eventos.precisaSincronizarMural))}function precisaSincronizar(){return function(){$("#sync").removeClass("botaoSync--sincronizado"),$("#sync").addClass("botaoSync--esperando");var o=[];$(".cartao").each(function(){var a=$(this),e=a.find(".cartao-conteudo").html(),r=a.css("background-color");o.push({conteudo:e,cor:r}),console.log(o)});var a={usuario:app.usuario,cartoes:o};$.ajax({url:"http://ceep.herokuapp.com/cartoes/salvar",method:"POST",data:a,dataType:"json",success:function(o){$("#sync").addClass("botaoSync--sincronizado"),console.log(o.quantidade+" cartoes salvos em "+o.usuario)},error:function(){$("#sync").addClass("botaoSync--deuRuim"),console.log("Nao foi possivel salvar o mural")},complete:function(){$("#sync").removeClass("botaoSync--esperando")}})}}var app=(jQuery,{usuario:"almde89@gmail.com"}),publisher=function(o){return{emitirEvento:function(){arguments.length&&(1==arguments.length?o(arguments[0].scope).trigger(arguments[0].name):2==arguments.length&&o(arguments[0]).trigger(arguments[1].toString()))}}}(jQuery),eventos={precisaSincronizarMural:{scope:document,name:"precisaSincronizar",toString:function(){return this.name}}};document.querySelector("#mudaLayout").addEventListener("click",function(){var o=document.querySelector(".mural");o.classList.toggle("mural--linhas"),o.classList.contains("mural--linhas")?this.textContent="Blocos":this.textContent="Linhas"}),$(".novoCartao").submit(salvaCartaoJquery),$("#sync").click(function(){publisher.emitirEvento(eventos.precisaSincronizarMural)}),$(eventos.precisaSincronizarMural.scope).on(eventos.precisaSincronizarMural.name,precisaSincronizar()),$("#ajuda").one("click",function(){$.getJSON("http://ceep.herokuapp.com/cartoes/instrucoes",function(o){console.log(o.instrucoes),$.each(o.instrucoes,function(){var o=this;console.log(o.conteudo),controladorCartoes.cria(o.conteudo,o.cor)})})}),$.getJSON("http://ceep.herokuapp.com/cartoes/carregar?callback=?",{usuario:app.usuario},function(o){var a=o.cartoes;console.log(a.length+" carregados em "+o.usuario),a.forEach(function(o){controladorCartoes.cria(o.conteudo,o.cor)})}),$("#busca").on("input",function(){var o=$(this).val().trim();o.length?$(".cartao").hide().filter(function(){return $(this).find(".cartao-conteudo").text().match(new RegExp(o,"i"))}).show():$(".cartao").show()});var controladorCartoes=function(o){"use strict";function a(){console.log("removeCartao()...");var o=this.dataset.idcartao,a=document.querySelector("#cartao"+o);a.classList.add("cartao--some"),setTimeout(function(){a.remove(),publisher.emitirEvento(eventos.precisaSincronizarMural)},170)}function e(o){console.log("decideTamanhoCartao()");var a=o.split("<br>").length;console.log("quebras: "+a);var e=o.replace(/<br>/g," ").length,r="";o.replace(/<br>/g," ").split(" ").forEach(function(o){o.length>r.length&&(r=o)},this);var t=r.length,n="cartao--textoPequeno";return t<9&&a<5&&e<55?n="cartao--textoGrande":t<12&&a<6&&e<75&&(n="cartao--textoMedio"),n}function r(a){var e=[{nome:"Padrão",codigo:"#EBEF40"},{nome:"Importante",codigo:"#F05450"},{nome:"Tarefa",codigo:"#92C4EC"},{nome:"Inspiração",codigo:"#76EF40"}],r=o("<div>").addClass("opcoesDoCartao-cores");return o.each(e,function(){var e=this,t="cor"+e.nome+"-"+a,n=o("<input>").addClass("opcoesDoCartao-radioCor").val(e.codigo).attr({type:"radio",id:t,name:"corDoCartao"+a}),c=o("<label>").addClass("opcoesDoCartao-opcao opcoesDoCartao-cor").text(e.nome).css("color",e.codigo).attr("for",t);r.append(n).append(c)}),r}return{cria:function(t,n){var c,s=o(".cartao").length;s++;var i=o("<p>").addClass("cartao-conteudo").attr("contenteditable",!0).html(t).on("input",function(){clearTimeout(c),c=setTimeout(function(){publisher.emitirEvento(eventos.precisaSincronizarMural)},1e3)});console.log(i);var l=o("<button>").addClass("opcoesDoCartao-opcao opcoesDoCartao-remove").text("Remove").click(a).attr("data-idcartao",s),u=o("<div>").addClass("opcoesDoCartao").append(l).append(r("cartao"+s)),d=e(t);console.log("classe tam cartao: "+d);var p=o("<div>").addClass("cartao").addClass(d).append(u).append(i).attr("id","cartao"+s).css("background-color",n).on("change",".opcoesDoCartao-radioCor",function(){var a=o(this).val();o("#cartao"+s).css("background-color",a),publisher.emitirEvento(eventos.precisaSincronizarMural)});console.log(p),o(".mural").prepend(p)}}}(jQuery);